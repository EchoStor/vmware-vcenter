<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>server.pp</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="params.html">params.pp</a>
          <a class="source" href="server.html">server.pp</a>
          <a class="source" href="vcsa.html">vcsa.pp</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>server.pp</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-Class:_vcenter::server'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Class:_vcenter::server">&#182;</a>
        </div>
        <h3>Class: vcenter::server</h3>

<p>Deploys vCenter Server.</p>

<h3>Parameters:</h3>

<ul>
<li>[<em>media</em>]:  vCenter installation media (default: &rsquo;D:\&lsquo;)</li>
<li>[<em>sql_media</em>]:  Microsoft SQL 2008R2 installation media (default: &rsquo;D:\&lsquo;)</li>
<li>[<em>username</em>]:  vCenter service username (default: &lsquo;VCENTER&rsquo;)</li>
<li>[<em>password</em>]:  vCenter service password (default: &lsquo;vC3nt!2008demo&rsquo;)</li>
<li>[<em>jvm_memory_option</em>]:  Inventory size (S, M, L) (default: &rsquo;S')</li>
<li>[<em>client</em>]:  Install vSphere client (default: true)</li>
<li>[<em>provider</em>]:  (default: $vcenter::params::provider)</li>
</ul>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">class</span> <span class="n">vcenter</span><span class="o">::</span><span class="n">server</span> <span class="p">(</span>
  <span class="vg">$media</span>             <span class="o">=</span> <span class="s1">&#39;D:\\&#39;</span><span class="p">,</span>           
  <span class="vg">$sql_media</span>         <span class="o">=</span> <span class="s1">&#39;D:\\&#39;</span><span class="p">,</span>           
  <span class="vg">$username</span>          <span class="o">=</span> <span class="s1">&#39;VCENTER&#39;</span><span class="p">,</span>        
  <span class="vg">$password</span>          <span class="o">=</span> <span class="s1">&#39;vC3nt!2008demo&#39;</span><span class="p">,</span> 
  <span class="vg">$jvm_memory_option</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span>              
  <span class="vg">$client</span>            <span class="o">=</span> <span class="kp">true</span>              
  <span class="vg">$provider</span>          <span class="o">=</span> <span class="vg">$vcenter</span><span class="o">::</span><span class="n">params</span><span class="o">::</span><span class="n">provider</span>
<span class="p">)</span> <span class="n">inherits</span> <span class="n">vcenter</span><span class="o">::</span><span class="n">params</span> <span class="p">{</span>

  <span class="n">user</span> <span class="p">{</span> <span class="vg">$username</span><span class="p">:</span>
    <span class="n">comment</span>  <span class="o">=&gt;</span> <span class="s1">&#39;VMware vCenter account.&#39;</span><span class="p">,</span>
    <span class="n">groups</span>   <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="n">password</span> <span class="o">=&gt;</span> <span class="vg">$password</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">class</span> <span class="p">{</span> <span class="s1">&#39;mssql&#39;</span><span class="p">:</span>
    <span class="n">features</span> <span class="o">=&gt;</span> <span class="s1">&#39;SQL,CONN,SSMS,ADV_SSMS&#39;</span><span class="p">,</span>
    <span class="n">media</span>    <span class="o">=&gt;</span> <span class="vg">$sql_media</span><span class="p">,</span>
    <span class="n">admin</span>    <span class="o">=&gt;</span> <span class="s2">&quot;Administrator</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">${username}&quot;</span><span class="p">,</span>
    <span class="nb">require</span>  <span class="o">=&gt;</span> <span class="no">User</span><span class="o">[</span><span class="s1">&#39;VCENTER&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;SQLSERVERAGENT&#39;</span><span class="p">:</span>
    <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
    <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="s1">&#39;mssql&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="vg">$sqlcmd</span> <span class="o">=</span> <span class="s1">&#39;&quot;C:\Program Files\Microsoft SQL Server\100\Tools\Binn\sqlcmd.exe&quot;&#39;</span>

  <span class="nb">exec</span> <span class="p">{</span> <span class="s1">&#39;create_database&#39;</span><span class="p">:</span>
    <span class="n">command</span>     <span class="o">=&gt;</span> <span class="s2">&quot;${sqlcmd} -Q </span><span class="se">\&quot;</span><span class="s2">if not exists(select * from sys.databases where name=&#39;vcenter&#39;) create database [vcenter]; alter database [vcenter] set recovery simple;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">path</span>        <span class="o">=&gt;</span> <span class="vg">$:</span><span class="ss">:path</span><span class="p">,</span>
    <span class="n">refreshonly</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
    <span class="n">subscribe</span>   <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="s1">&#39;mssql&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry_key</span> <span class="p">{</span> <span class="o">[</span> <span class="s1">&#39;HKLM\SOFTWARE\ODBC&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;HKLM\SOFTWARE\ODBC\ODBC.INI&#39;</span> <span class="o">]</span><span class="p">:</span>
    <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="no">Registry</span><span class="o">::</span><span class="no">Value</span> <span class="p">{</span>
    <span class="n">key</span>   <span class="o">=&gt;</span> <span class="s1">&#39;HKLM\SOFTWARE\ODBC\ODBC.INI\VMware VirtualCenter&#39;</span><span class="p">,</span>
    <span class="n">notify</span> <span class="o">=&gt;</span> <span class="no">Exec</span><span class="o">[</span><span class="s1">&#39;create_database&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="n">before</span> <span class="o">=&gt;</span> <span class="no">Exec</span><span class="o">[</span><span class="s1">&#39;install_vCenter&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;VMware VirtualCenter&#39;</span><span class="p">:</span>
    <span class="n">key</span>   <span class="o">=&gt;</span> <span class="s1">&#39;HKLM\SOFTWARE\ODBC\ODBC.INI\ODBC Data Sources&#39;</span><span class="p">,</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;VMware VirtualCenter&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s1">&#39;SQL Server Native Client 10.0&#39;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;Driver&#39;</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Driver&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">system32</span><span class="se">\\</span><span class="s2">sqlncli10.dll&quot;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;Server&#39;</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Server&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s1">&#39;(local)&#39;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;Database&#39;</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Database&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s1">&#39;vcenter&#39;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;LastUser&#39;</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;LastUser&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">registry</span><span class="o">::</span><span class="n">value</span> <span class="p">{</span> <span class="s1">&#39;Trusted_Connection&#39;</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=&gt;</span> <span class="s1">&#39;Trusted_Connection&#39;</span><span class="p">,</span>
    <span class="n">data</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span>
    <span class="n">type</span>  <span class="o">=&gt;</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="nb">exec</span> <span class="p">{</span> <span class="s1">&#39;install_vCenter&#39;</span><span class="p">:</span>
    <span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;vCenter-Server\\VMware-vcserver.exe /s /w /L1033 /v&quot;/qr USERNAME=Administrator COMPANYNAME=Puppet DB_SERVER_TYPE=Custom DB_DSN=\&quot;VMWARE VirtualCenter\&quot; DB_DSN_WINDOWS_AUTH=1 FORMAT_DB=1&quot;&#39;</span><span class="p">,</span>
    <span class="n">creates</span> <span class="o">=&gt;</span> <span class="s1">&#39;C:\Program Files\VMware\Infrastructure\VirtualCenter Server&#39;</span><span class="p">,</span>
    <span class="n">path</span>    <span class="o">=&gt;</span> <span class="vg">$media</span><span class="p">,</span>
    <span class="n">timeout</span> <span class="o">=&gt;</span> <span class="mi">1200</span><span class="p">,</span>
    <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="s1">&#39;mssql&#39;</span><span class="o">]</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="vg">$client</span> <span class="p">{</span>
    <span class="nb">exec</span> <span class="p">{</span> <span class="s1">&#39;install_vSphere_client&#39;</span><span class="p">:</span>
      <span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;vSphere-Client\\VMware-viclient.exe /s /w /L1033 /v&quot; /qr&quot;&#39;</span><span class="p">,</span>
      <span class="n">creates</span> <span class="o">=&gt;</span> <span class="s1">&#39;C:\Program Files (x86)\VMware\Infrastructure\Virtual Infrastructure Client&#39;</span><span class="p">,</span>
      <span class="n">path</span>    <span class="o">=&gt;</span> <span class="vg">$media</span><span class="p">,</span>
      <span class="n">timeout</span> <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Exec</span><span class="o">[</span><span class="s1">&#39;install_vCenter&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>Install rbvmomi gem for vc_* resources.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">package</span> <span class="p">{</span> <span class="s1">&#39;rbvmomi&#39;</span><span class="p">:</span>
    <span class="k">ensure</span>   <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
    <span class="n">provider</span> <span class="o">=&gt;</span> <span class="vg">$provider</span><span class="p">,</span>
  <span class="p">}</span>

<span class="p">}</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
